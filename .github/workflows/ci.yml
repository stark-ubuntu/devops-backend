name: Quarkus - Continuous Integration

on:
  workflow_call:
    inputs:
      name:
        type: string
        description: 'Application Name'
        required: true
        default: 'your-app-name'
      version:
        type: string
        description: 'Application Version'
        required: true
        default: '1.0.0'

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout 🤨
        uses: actions/checkout@v2
        with:
          repository: ${{ github.event.inputs.repo }}
          token: ${{ secrets.GITHUB_TOKEN }}
          path: project

      - name: Set up JDK 🧐
        uses: actions/setup-java@v2
        with:
          java-version: '17'
          distribution: 'temurin'
          
      - name: Build with Maven 🏗️
        run: mvn clean install -DskipTests -f project/pom.xml
        
      - name: Package application 📦
        run: mvn package -DskipTests -f project/pom.xml
      
      - name: Build Docker image 👷🏾‍♂️
        env:
          IMAGE_NAME: ${{ inputs.name }} 
          IMAGE_TAG: ${{ inputs.version }}
        run: |
          docker build -f project/src/main/docker/Dockerfile.jvm -t matheusfideles/${{ env.IMAGE_NAME }}:${{ env.IMAGE_TAG }} .
          
      - name: Push Docker image 🔝
        env:
          DOCKER_USERNAME: ${{ vars.DOCKER_USERNAME }}
          DOCKER_PASSWORD: ${{ secrets.DOCKER_PASSWORD }}
          IMAGE_NAME: ${{ inputs.name }}
          IMAGE_TAG: ${{ inputs.version }}
        run: echo "push image success"
          #publicar no docker hub depois!

      - name: CI Pipeline Completed 🫡
        run: echo "CI Pipeline for ${{ github.event.inputs.name }} version ${{ github.event.inputs.version }} has been completed successfully!"

     # - name: Run tests 🏃🏿‍➡️
      #   run: mvn test -f project/pom.xml
